<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•…äº‹å…§å®¹ - ã€Šä¿®ä»™-ä¸ƒç„é—œã€‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="antialiased">
    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-[#A36B4F]">ã€Šä¿®ä»™-ä¸ƒç„é—œã€‹</h1>
            <p class="text-lg text-gray-600 mt-2">æ•…äº‹å…§å®¹</p>
        </header>

        <!-- é¡µé¢å¯¼èˆª -->
        <nav class="page-nav">
            <a href="index.html">ğŸ  é¦–é¡µ</a>
            <a href="overview.html">ğŸ‘¥ äººç‰©ç¸½è¦½</a>
            <a href="relations.html">ğŸ•¸ï¸ é—œä¿‚ç¶²çµ¡</a>
            <a href="structure.html">ğŸ“Š é—œä¿‚åœ–</a>
            <a href="chapters.html">ğŸ“– ç« ç¯€å¤§ç¶±</a>
            <a href="antagonists.html">âš”ï¸ åæ´¾å‰–æ</a>
            <a href="story.html" class="active">ğŸ“š æ•…äº‹å…§å®¹</a>
        </nav>

        <main>
            <!-- æ•…äº‹å…ƒä¿¡æ¯ -->
            <div class="bg-white rounded-lg p-6 shadow-md mb-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-[#38342E] mb-2" id="chapter-title">ç¬¬ä¸€ç« ï¼šå˜‰ç¾©å¤œé›¨</h2>
                    <p class="text-gray-600" id="chapter-summary">æ—æ‰¿ç¥åœ¨æ·±å¤œæ¥åˆ°ç¥ç§˜å‘½æ¡ˆå ±å‘Šï¼Œå‰å¾€å˜‰ç¾©é„‰é–“èª¿æŸ¥ä¸€èµ·æ¶‰åŠç¬¦ç±™å’Œå®—æ•™çš„æ¡ˆä»¶ï¼Œæ­é–‹äº†åäº”å¹´å‰ã€Œç™½è¡£è§€éŸ³æ¡ˆã€çš„é™°å½±ã€‚</p>
                </div>
                
                <!-- æ•…äº‹ç»Ÿè®¡ -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-[#A36B4F]" id="total-segments">8</div>
                        <div class="text-sm text-gray-600">æ®µè½æ•¸</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-[#A36B4F]" id="total-words">4,643</div>
                        <div class="text-sm text-gray-600">ç¸½å­—æ•¸</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-[#A36B4F]">æ‡¸ç–‘æ¨ç†</div>
                        <div class="text-sm text-gray-600">é¡å‹</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-[#A36B4F]">ç¬¬ä¸‰äººç¨±</div>
                        <div class="text-sm text-gray-600">è¦–è§’</div>
                    </div>
                </div>

                <!-- ä¸»é¢˜æ ‡ç­¾ -->
                <div class="flex flex-wrap gap-2 justify-center">
                    <span class="px-3 py-1 bg-[#F3ECE4] text-[#A36B4F] rounded-full text-sm">å®—æ•™èˆ‡ç§‘å­¸çš„å°ç«‹</span>
                    <span class="px-3 py-1 bg-[#F3ECE4] text-[#A36B4F] rounded-full text-sm">éå»å‰µå‚·çš„å¾©ç¾</span>
                    <span class="px-3 py-1 bg-[#F3ECE4] text-[#A36B4F] rounded-full text-sm">é«”åˆ¶èˆ‡çœŸç›¸çš„è¡çª</span>
                    <span class="px-3 py-1 bg-[#F3ECE4] text-[#A36B4F] rounded-full text-sm">è¶…è‡ªç„¶èˆ‡ç†æ€§çš„ç¢°æ’</span>
                </div>
            </div>

            <!-- æ®µè½å¯¼èˆª -->
            <div class="bg-white rounded-lg p-6 shadow-md mb-8">
                <h3 class="text-xl font-bold text-[#38342E] mb-4">æ®µè½å°èˆª</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3" id="segment-nav">
                    <!-- æ®µè½å¯¼èˆªæŒ‰é’®å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
                </div>
            </div>

            <!-- æ•…äº‹å†…å®¹ -->
            <div class="space-y-8 reading-container" id="story-content">
                <!-- æ•…äº‹æ®µè½å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
            </div>

            <!-- åˆ†æé¢æ¿ -->
            <div class="mt-12 bg-[#F3ECE4] rounded-lg p-6">
                <h3 class="text-xl font-bold text-[#38342E] mb-4">æ•…äº‹åˆ†æ</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-[#A36B4F] mb-2">æ–‡å­¸æŠ€å·§</h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>â€¢ æ„Ÿå®˜æå¯«</li>
                            <li>â€¢ è±¡å¾µæ‰‹æ³•</li>
                            <li>â€¢ å°æ¯”æ‰‹æ³•</li>
                            <li>â€¢ ä¼ç­†è¨­ç½®</li>
                            <li>â€¢ æ°›åœç‡Ÿé€ </li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-[#A36B4F] mb-2">é—œéµè±¡å¾µ</h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>â€¢ ç¬¦ç±™ - è¶…è‡ªç„¶åŠ›é‡çš„è¼‰é«”</li>
                            <li>â€¢ åœ“å½¢ç¬¦è™Ÿ - æœªçŸ¥çš„æ¼”ç®—æ³•æˆ–å„€å¼</li>
                            <li>â€¢ é¦™æ°£ - è½‰åŒ–èˆ‡æ§åˆ¶</li>
                            <li>â€¢ é›¨ - æ´—æ»Œèˆ‡é‡ç”Ÿ</li>
                            <li>â€¢ æœ¨ç‰Œ - éš±è—çš„çœŸç›¸</li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ç­‰å¾…JSONæ•°æ®åŠ è½½
        document.addEventListener('DOMContentLoaded', () => {
            fetch('story-structured.json')
                .then(res => res.json())
                .then(data => {
                    renderStory(data);
                })
                .catch(err => {
                    console.error('ç„¡æ³•è¼‰å…¥ story-structured.json', err);
                    // å›é€€ï¼šæä¾›æœ€å°çµæ§‹ä»¥é¿å…é é¢ç©ºç™½
                    renderStory({
                        chapter_1: {
                            title: 'è³‡æ–™è¼‰å…¥å¤±æ•—',
                            summary: 'è«‹ç¢ºèªä»¥æœ¬æ©Ÿä¼ºæœå™¨é–‹å•Ÿæˆ–æª”æ¡ˆè·¯å¾‘æ­£ç¢ºã€‚',
                            segments: {},
                            chapter_summary: { total_segments: 0, total_word_count: 0 }
                        }
                    });
                });
        });

        function renderStory(data) {
            const chapter = data.chapter_1;
            const segments = chapter.segments;
            
            // æ›´æ–°ç« èŠ‚ä¿¡æ¯
            document.getElementById('chapter-title').textContent = chapter.title;
            document.getElementById('chapter-summary').textContent = chapter.summary;
            document.getElementById('total-segments').textContent = chapter.chapter_summary.total_segments;
            document.getElementById('total-words').textContent = chapter.chapter_summary.total_word_count.toLocaleString();

            // ç”Ÿæˆæ®µè½å°èˆª
            const segmentNav = document.getElementById('segment-nav');
            segmentNav.innerHTML = '';
            
            Object.values(segments).forEach(segment => {
                const navButton = document.createElement('button');
                navButton.className = 'bg-white border border-gray-200 rounded-lg p-3 text-left hover:bg-gray-50 transition-colors';
                navButton.innerHTML = `
                    <div class="font-semibold text-sm text-[#38342E]">${segment.title}</div>
                    <div class="text-xs text-gray-500 mt-1">${segment.word_count} å­—</div>
                `;
                navButton.onclick = () => scrollToSegment(segment.sequence);
                segmentNav.appendChild(navButton);
            });

            // ç”Ÿæˆæ•…äº‹å†…å®¹
            const storyContent = document.getElementById('story-content');
            storyContent.innerHTML = '';
            
            Object.values(segments).forEach(segment => {
                const segmentDiv = document.createElement('div');
                segmentDiv.id = `segment-${segment.sequence}`;
                segmentDiv.className = 'bg-white rounded-lg p-6 shadow-md';
                // å°‡ content ä¾ç©ºè¡Œåˆ‡æˆæ®µè½
                const paragraphs = (segment.content || '')
                    .split(/\n\s*\n/) // ä»¥ç©ºè¡Œåˆ†æ®µ
                    .map(s => s.trim())
                    .filter(Boolean);

                const paragraphsHtml = paragraphs.length
                    ? paragraphs.map(p => `<p class=\"indent-2em mb-4 leading-8 text-gray-800\">${p}</p>`).join('')
                    : `<p class=\"indent-2em mb-4 leading-8 text-gray-800\">${segment.content || ''}</p>`;

                segmentDiv.innerHTML = `
                    <div class="border-b border-gray-200 pb-4 mb-4">
                        <h3 class="text-xl font-bold text-[#38342E] mb-2">${segment.title}</h3>
                        <p class="text-gray-600 text-sm mb-2">${segment.summary}</p>
                        <div class="flex flex-wrap gap-2 text-xs">
                            <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded">${segment.word_count} å­—</span>
                            <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded">${segment.analysis.setting}</span>
                            <span class="px-2 py-1 bg-gray-100 text-gray-600 rounded">${segment.analysis.time}</span>
                        </div>
                    </div>
                    <div class="prose max-w-none">
                        ${paragraphsHtml}
                    </div>
                    <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-semibold text-[#A36B4F] mb-2">æ®µè½åˆ†æ</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <strong>äººç‰©ï¼š</strong> ${segment.analysis.characters.join('ã€')}<br>
                                <strong>é—œéµäº‹ä»¶ï¼š</strong> ${segment.analysis.key_events.join('ã€')}<br>
                                <strong>æƒ…æ„ŸåŸºèª¿ï¼š</strong> ${segment.analysis.emotional_tone}
                            </div>
                            <div>
                                <strong>æ–‡å­¸æŠ€å·§ï¼š</strong> ${segment.analysis.literary_devices.join('ã€')}<br>
                                <strong>ä¼ç­†ï¼š</strong> ${segment.analysis.foreshadowing}
                            </div>
                        </div>
                    </div>
                `;
                storyContent.appendChild(segmentDiv);
            });
        }

        function scrollToSegment(sequence) {
            const element = document.getElementById(`segment-${sequence}`);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
    </script>
</body>
</html>
